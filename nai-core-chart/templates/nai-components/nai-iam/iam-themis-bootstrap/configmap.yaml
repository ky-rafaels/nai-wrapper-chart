apiVersion: v1
kind: ConfigMap
metadata:
  name: iam-themis-bootstrap-config
  namespace: {{ .Release.Namespace }}
  labels:
    app.kubernetes.io/component: nai-iam-themis-bootstrap
    {{- include "nai-core.labels" . | nindent 4 }}
data:
  iam_bootstrap_config: |
    iamServerName                  : "iam-proxy.{{ .Release.Namespace }}"
    iamServerHttpsPort             : 8443
    iamServerMtlsPort              : 8445
    iamServerProtocol              : "https"
    iamHost                        : "iam-proxy.{{ .Release.Namespace }}:8445"
    iamThemisLatestHost            : "iam-themis.{{ .Release.Namespace }}:5558"
    iamThemisServerName            : "iam-themis.{{ .Release.Namespace }}"
    iamVersionFilePath             : "/etc/iam_version/..data/iam_version.yaml"
    iamBasePath                    : "/api/iam"
    authNV4BasePath                : "/api/iam/v4.1.b1/authn/"
    authZSuffix                    : "/authz/v1"
    authNSuffix                    : "/authn/v1/"
    themisConfigPath               : "/home/nutanix/config/themis/"
    scheme                         : "https"
    ca                             : "/etc/tls_secrets/ca.crt"
    crt                            : "/etc/tls_secrets/tls.crt"
    key                            : "/etc/tls_secrets/tls.key"
    insecureSkipVerify             : false
    delaySeconds                   : 10
    timeoutSeconds                 : 300
    requestTimeoutSecond           : 300
    batchSize                      : 100
    retryCount                     : 3
    precheckRetryTimeout           : 30
    retryWaitTime                  : 30
    maxRetryCount                  : 4
    waitTime                       : 120
    ptestEnvironment               : true
    httpClientConfig:
      authzClient:
        scheme: "https"
        serverName: "iam-themis"
        hostName: "iam-themis.{{ .Release.Namespace }}:5558"
        basePath: "/api/iam"
        suffix: "/authz/v1/"
        retryCount: 3
        delayInSecBetweenRetries: 10
        timeoutInSec: 60
      authnClient:
        scheme: "https"
        serverName: "iam-user-authn"
        hostName: "iam-user-authn.{{ .Release.Namespace }}:5556"
        basePath: "/api/iam"
        suffix: "/authn/v1/"
        retryCount: 3
        delayInSecBetweenRetries: 10
        timeoutInSec: 30
